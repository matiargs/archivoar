steps:
  publish:
    image: woodpeckerci/plugin-docker-buildx:4.0.0
    settings:
      auto_tag: true
      tag: ci-${CI_COMMIT_SHA:0:8}
      registry: reg.terrarium.ar
      repo: reg.terrarium.ar/archivoar/website
      username: matiargs
      password:
        from_secret: reg_secret

  deploy:
    image: appleboy/drone-ssh
    settings:
      host:
        from_secret: ssh_host
      username: 
        from_secret: ssh_username
      key:
        from_secret: ssh_key
      port: 
        from_secret: ssh_port
      command_timeout: 2m
      script:
        - cd public-services/archivoar
        - docker compose pull
        - docker compose up -d